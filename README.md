<div align="center">

# 墨 渊 工 坊

**· AI 长篇小说创作引擎 ·**

*"以前写小说要三年，现在只需要三杯咖啡。"*

---

[![单文件](https://img.shields.io/badge/单文件-零依赖-c8a44a?style=flat-square)]()
[![License](https://img.shields.io/badge/license-MIT-2a6b4f?style=flat-square)]()
[![providers](https://img.shields.io/badge/AI_供应商-4_家-8b1a2e?style=flat-square)]()
[![mobile](https://img.shields.io/badge/移动端-完整支持-5b3fa0?style=flat-square)]()

<br>

**下载一个 HTML 文件。双击打开。开始写你脑子里那个故事。**

[立即开始](#-快速开始) · [功能总览](#️-功能总览) · [技术细节](#️-技术细节) · [API 配置](#-api-配置)

</div>

---

## 这是什么

你有一个故事在脑子里住了很久——有人物，有矛盾，有结局——但就是没有落纸。

不是因为你不会写。是因为开头太难，第三章太难，第七章的转折更难。

**墨渊工坊**解决的就是这件事。

你来掌舵剧情走向，AI 负责把你的意图变成真正的文字。每章生成后，你有 **4 次修改机会**——局部微调或整章推翻重来。你的故事，你说了算。

> 纯前端，零后端，所有数据只在你的浏览器里。

---

## ✨ 核心特性

**一个文件走天下**
整个应用就是一个 `index.html`。没有 `npm install`，没有 `node_modules`，没有构建步骤。下载，双击，用。

**多 AI 供应商，一键切换**
DeepSeek、OpenAI、Anthropic Claude，或者任何兼容 OpenAI 格式的自定义接口——在设置页面选一个，填入 API Key，开始创作。

**精密的情感强度系统**
5 档强度 × 7 种题材 = **35 组独立写作指令矩阵**。第 1 档克制到指尖触碰，第 5 档直白到毫无保留。每一档都有针对不同类型的专项写作指令，不是换个词，是换一套写法。

**上下文真正连贯**
每次生成新章节，自动携带前章结尾 **800 字**保证文风延续，同时附带更早章节的**智能摘要**（人物变化 · 关键事件 · 新增伏笔 · 结尾状态），让 AI 知道"之前发生了什么"。

**实时流式输出**
文字像打字一样一个个出现，告别等待黑盒。完整实现 SSE 解析，包含跨 chunk 边界处理和最后一帧 flush。

**去甲模式 🔓**
去除 AI 的自我审查倾向，直接输出完整故事，无说教，无警告，无免责声明。

---

## 📊 用数据说话

| 维度 | 数值 |
|------|------|
| 项目文件数 | **1 个** |
| 外部依赖 | **0 个** |
| 支持 AI 供应商 | **4 家** |
| 小说类型 | **7 种**（言情 / 玄幻 / 都市 / 悬疑 / 科幻 / 历史 / 情欲） |
| 写作风格 | **6 种**（文艺 / 暧昧 / 热血 / 黑暗 / 史诗 / 幽默） |
| 情感强度档位 | **5 级** |
| 写作指令矩阵 | **35 组**（5 档 × 7 类型） |
| 每章修改配额 | **4 轮**（局部微调 or 整章改写） |
| 最大章节数 | **50 章**（约 20 万字） |
| 每章字数可选 | 800 / 1500 / 2500 / 4000 字 |
| 前章上下文 | 结尾 **800 字** + 更早章节各 **120 字**摘要 |
| 复制降级方案 | **3 层**（永远有办法复制） |

---

## 🚀 快速开始

**第一步：获取文件**

```bash
git clone https://github.com/your-username/moyuan-studio.git
# 或者直接下载 index.html 单文件
```

**第二步：打开**

```
双击 index.html
```

**第三步：配置 API Key**

右上角 ⚙️ → 选择供应商 → 填入 API Key → 保存配置

推荐从 **DeepSeek** 开始，中文表现优秀，价格极低。

**第四步：创作**

1. 「创作设定」填写标题、类型、故事大纲
2. 点击 `✦ 创 建 项 目`
3. 前往「章节」页面，选择第一章
4. 填写本章剧情提示，点击生成

> 💡 **不想从零开始？** 点击「📖 加载演示项目」，立刻体验完整流程——《霸总的温柔陷阱》已为你备好，10章 · 上海 · 言情。

---

## 🗺️ 功能总览

```
墨渊工坊
│
├── ⚙️  创作设定
│       ├── 小说标题、类型（7种）、写作风格（6种）
│       ├── 情感强度 5 档滑块
│       ├── 🔓 去甲模式
│       ├── 主角 / 配角 / 世界背景
│       └── 故事大纲 + 章节数 + 每章字数
│
├── 📖  章节管理
│       ├── 自动生成章节列表
│       ├── 状态追踪：待创作 → 创作中 → ✓ 完成
│       ├── 进度条可视化
│       └── 单章复制 / 标题编辑 / 重置 / 删除
│
├── ✍️  写作台
│       ├── 本章剧情提示 + 额外创作要求
│       ├── 实时流式输出（SSE）
│       ├── 局部微调：粘贴原文片段 → 精准替换
│       ├── 整章改写：一键推倒重来
│       ├── 字数实时统计
│       └── 快捷键：Ctrl/⌘+Enter 生成 · Ctrl/⌘+S 存档
│
└── 📊  存档 & 导出
        ├── 完成章节 / 总字数 / 修改次数统计
        ├── 导出 .txt（BOM 编码，Windows 完美显示）
        └── 导出 .md（含书名、类型、字数等元数据）
```

---

## 🎚️ 情感强度系统

这是墨渊工坊最花心思的部分。

| 档位 | 名称 | 写作基调 |
|------|------|---------|
| ⬜ 第 1 档 | 温馨清水 | 情感点到为止，心跳停留在指尖，无肢体延伸 |
| 🟨 第 2 档 | 淡淡暧昧 | 半遮半掩的试探，靠近又退缩，话说一半停下来 |
| 🟧 第 3 档 | 中等尺度 | 欲望与理智明确拉锯，情绪有力度但仍有收束 |
| 🟥 第 4 档 | 热烈直接 | 情感完全外放，五感具体细腻，强烈冲击 |
| ⬛ 第 5 档 | 大胆露骨 | 五感全开，毫无遮掩，情绪与感官推向极致 |

每一档都针对 7 种题材提供专属写作指令。调整档位不只是换个措辞，是换一整套叙事逻辑。

---

## 🤖 API 配置

| 供应商 | 推荐模型 | 特点 |
|--------|----------|------|
| **DeepSeek** ⭐ | `deepseek-chat` | 中文顶尖，价格极低，首选 |
| **OpenAI** | `gpt-4o` / `gpt-4o-mini` | 国际主流，质量稳定 |
| **Claude** | `claude-sonnet-4-5` | 创意写作见长，长文表现出色 |
| **自定义** | 任意 | 支持所有 OpenAI 兼容接口 |

支持「持久记住」（localStorage）和「仅当前会话」（sessionStorage）两种 Key 保存模式。

---

## 🛠️ 技术细节

<details>
<summary><b>流式输出（SSE）实现</b></summary>

完整实现 Server-Sent Events 解析，包含跨 chunk 的 `\n` 边界处理和最后一帧 buffer flush——这些是被大多数实现遗漏的细节，但用户在网络抖动时会切实感受到差异。

同时支持 OpenAI 和 Anthropic Claude 两种不同的 SSE 数据格式，一套解析器兼容四家供应商。

</details>

<details>
<summary><b>智能上下文管理</b></summary>

上下文摘要算法自动提炼关键句、识别伏笔关键词（线索 / 秘密 / 预感 / 约定……），在有限 token 预算内最大化上下文信息密度，确保章节间的逻辑和人物一致性。

</details>

<details>
<summary><b>三层复制降级策略</b></summary>

```
Clipboard API（现代浏览器）
    ↓ 失败时降级
execCommand copy（兼容旧浏览器 / file:// 协议）
    ↓ 失败时降级
手动提示框（终极兜底，永远可用）
```

</details>

<details>
<summary><b>错误恢复机制</b></summary>

生成或修改失败时，自动将输出框恢复为原有内容。你永远不会因为 API 超时或网络中断丢失之前的工作成果。

</details>

<details>
<summary><b>移动端适配</b></summary>

iOS Safe Area 完整适配（`env(safe-area-inset-*)`），触觉反馈（Vibration API），`prefers-reduced-motion` 无障碍支持，最大宽度 540px 的移动优先布局。

</details>

---

## 🔒 隐私说明

- ✅ **API Key** 仅存储于本地浏览器，不经过任何中间服务器
- ✅ **小说内容** 仅存储于本地浏览器
- ✅ **零后端**，零数据收集，零追踪
- ⚠️ 内容会直接发送给所选的 AI 供应商，请遵守其服务条款

---

## 📁 项目结构

```
.
└── index.html    ← 全部。就这一个。
```

是的，这就是完整的项目结构。我们对此感到骄傲。

---

## 🗺️ 后续计划

- [ ] 章节草稿历史版本（多次反悔）
- [ ] 人物关系图谱自动生成
- [ ] 一键续写模式（批量生成所有章节）
- [ ] PWA 支持（离线可用，添加到桌面）
- [ ] 导出 EPUB 格式

欢迎提 Issue 和 PR，有想法直接说。

---

## 📄 License

[MIT](LICENSE) · 自由使用，自由修改，自由分发。

---

<div align="center">

<br>

**把脑子里的故事，写出来。**

*一个文件。无限可能。*

<br>

如果这个项目帮到了你，点一颗 ⭐ 就是最好的支持。

</div>